<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Technical SEO Quiz</title>

  <!-- SNS向け（最低限） -->
  <meta property="og:title" content="Technical SEO Quiz" />
  <meta property="og:description" content="Browser-based Technical SEO quiz game (Crawl / Index / CWV / Canonical / Rendering)." />
  <meta property="og:url" content="https://takuma51.github.io/techseo-quiz/" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{
      --bg0:#0b1020;
      --bg1:#0e1630;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.085);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --brand:#7c5cff;
      --brand2:#22c1c3;
      --ok:#2dd4bf;
      --ng:#fb7185;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r:18px;
      --r2:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(124,92,255,.35), transparent 55%),
        radial-gradient(900px 520px at 95% 10%, rgba(34,193,195,.25), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{max-width:980px;margin:0 auto;padding:26px 18px 80px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:14px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;
    }
    .logo{
      width:40px;height:40px;border-radius:14px;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(34,193,195,.9));
      box-shadow: 0 10px 30px rgba(124,92,255,.25);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute;inset:10px;
      border-radius:12px;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.18);
    }
    h1{font-size:24px;margin:0}
    .subtitle{color:var(--muted);font-size:13px;margin-top:2px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

    .card{
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.04));
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      padding:16px;
      backdrop-filter: blur(12px);
    }
    .grid{
      display:grid;gap:14px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 920px){ .grid{grid-template-columns:1fr} }

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color:var(--text);
      font-size:13px;
    }
    .pill b{font-variant-numeric:tabular-nums}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row.space{justify-content:space-between}
    .muted{color:var(--muted)}
    .hr{height:1px;background:rgba(255,255,255,.10);margin:12px 0}

    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color:var(--text);
      border-radius: 14px;
      padding:10px 12px;
      cursor:pointer;
      transition: transform .08s ease, filter .15s ease, background .15s ease;
      display:inline-flex;align-items:center;gap:8px;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(124,92,255,.55);
      background: linear-gradient(135deg, rgba(124,92,255,.34), rgba(34,193,195,.16));
    }
    .btn.ghost{background: transparent}
    .btn.good{border-color: rgba(45,212,191,.55)}
    .btn.bad{border-color: rgba(251,113,133,.55)}

    select,input{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color:var(--text);
      border-radius: 14px;
      padding:10px 12px;
      outline:none;
    }
    input{width:110px}

    .progress{
      height:10px;border-radius:999px;background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(124,92,255,.95), rgba(34,193,195,.95));
      border-radius:999px;
      transition: width .25s ease;
    }

    .qmeta{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .chip{
      font-size:12px; padding:6px 10px;border-radius:999px;
      border:1px solid var(--stroke); background: rgba(255,255,255,.04);
      color:var(--muted);
    }
    .qtitle{font-size:20px;margin:10px 0 12px;line-height:1.35}
    .choices{display:grid;gap:10px}
    .choice{
      text-align:left;
      padding:12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.045);
      border:1px solid rgba(255,255,255,.12);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .choice:hover{background: rgba(255,255,255,.06)}
    .choice.correct{border-color: rgba(45,212,191,.55); background: rgba(45,212,191,.10)}
    .choice.wrong{border-color: rgba(251,113,133,.55); background: rgba(251,113,133,.10)}

    .feedback{
      display:none;
      margin-top:12px;
      padding:14px;
      border-radius: var(--r);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
    .feedback.show{display:block}
    .ok{color:var(--ok)} .ng{color:var(--ng)}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px}

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      padding:20px;
      z-index:50;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(560px, 100%);
      border-radius: 24px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 28px 90px rgba(0,0,0,.55);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .modal h3{margin:0 0 6px;font-size:18px}
    .modal .big{font-size:28px;margin:6px 0 10px}
    .modal .sub{color:var(--muted);font-size:13px}
    .modal .row{margin-top:12px;justify-content:flex-end}
    .glow{
      position:absolute; inset:-80px;
      background: radial-gradient(600px 320px at 40% 20%, rgba(124,92,255,.45), transparent 60%),
                  radial-gradient(520px 280px at 80% 10%, rgba(34,193,195,.35), transparent 62%);
      filter: blur(10px);
      opacity:.85;
      pointer-events:none;
    }

    /* Confetti */
    .confetti{
      position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:60;
      display:none;
    }
    .confetti.show{display:block}
    .piece{
      position:absolute;
      width:10px;height:16px;
      border-radius: 4px;
      opacity:.95;
      top:-20px;
      animation: fall linear forwards;
    }
    @keyframes fall{
      to{ transform: translateY(calc(100vh + 40px)) rotate(720deg); }
    }

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px}
    .tiny{font-size:12px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Technical SEO Quiz</h1>
          <div class="subtitle">ブラウザだけで動く／URL共有OK。ランクで成長が見えるクイズ。</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn ghost" id="shareBtn">🔗 URLをコピー</button>
        <button class="btn ghost" id="resetBestBtn">🧹 記録リセット</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row space">
          <div class="row">
            <span class="pill">スコア <b id="score">0</b></span>
            <span class="pill">正解数 <b id="correct">0</b></span>
            <span class="pill">連続 <b id="streak">0</b></span>
            <span class="pill">残り <b id="remaining">0</b></span>
            <span class="pill">タイム <b id="time">—</b></span>
            <span class="muted tiny">出題数</span>
            <select id="count">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100" selected>100</option>
            </select>
          </div>
          <span class="pill">ランク <b id="rank">—</b></span>
        </div>

        <div class="hr"></div>

        <div class="row">
          <span class="muted tiny">出題</span>
          <select id="mode">
            <option value="all">すべて</option>
            <option value="Crawl">Crawl</option>
            <option value="Index">Index</option>
            <option value="CWV">CWV</option>
            <option value="Rendering">Rendering</option>
            <option value="Schema">Schema</option>
            <option value="Logs">Logs</option>
          </select>

          <span class="muted tiny">並び</span>
          <select id="order">
            <option value="random">ランダム</option>
            <option value="sequential">順番</option>
          </select>

          <span class="muted tiny">制限(秒)</span>
          <input id="limit" type="number" min="0" value="20" />

          <button class="btn primary" id="startBtn">▶️ スタート</button>
          <button class="btn" id="importBtn">⬆️ 問題JSONを貼り付け</button>
        </div>

        <div class="hr"></div>

        <div class="row space">
          <div style="flex:1;min-width:220px">
            <div class="muted tiny" id="progressLabel">進捗 0 / 0</div>
            <div class="progress"><div class="bar" id="bar"></div></div>
          </div>
          <div class="muted tiny" id="bestBox">自己ベスト: <b id="best">0</b> / 最高ランク: <b id="bestRank">—</b></div>
        </div>
      </div>

      <div class="card" id="qCard">
        <div class="qmeta" id="qMeta"></div>
        <div class="qtitle" id="question">スタートを押してね</div>
        <div class="choices" id="choices"></div>

        <div class="feedback" id="feedback"></div>

        <div class="hr"></div>

        <div class="row">
          <button class="btn" id="skipBtn">⏭️ スキップ</button>
          <button class="btn primary" id="nextBtn">➡️ 次へ</button>
        </div>

        <div class="muted tiny" style="margin-top:10px">
          ショートカット: <span class="kbd">1-4</span>で回答 / <span class="kbd">Enter</span>で次へ
        </div>
      </div>
    </div>

    <footer>
      Created by <b>Takuma Oka</b> · Technical SEO Quiz
    </footer>
  </div>

  <!-- Rank modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="glow"></div>
      <h3>ランクアップ！</h3>
      <div class="big" id="rankTitle">—</div>
      <div class="sub" id="rankSub">—</div>
      <div class="row">
        <button class="btn primary" id="closeModalBtn">OK</button>
      </div>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <!-- Import modal (simple prompt-like) -->
  <div class="overlay" id="importOverlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="glow"></div>
      <h3>問題JSONを貼り付け</h3>
      <div class="sub">形式: [{ id, level, tags:[...], q, choices:[...], answer, explain }...]</div>
      <div style="margin-top:10px">
        <textarea id="importArea" style="width:100%;height:200px;border-radius:16px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.25);color:var(--text);padding:12px;outline:none"></textarea>
      </div>
      <div class="row" style="justify-content:space-between;margin-top:12px">
        <button class="btn" id="cancelImportBtn">キャンセル</button>
        <button class="btn primary" id="applyImportBtn">適用</button>
      </div>
    </div>
  </div>

<script>
/** =========================================================
 *  1) QUESTIONS（ここを100問に増やしていく）
 *     ※ まずは動作確認用に一部だけ入れてある
 *     ※ 「Import（JSON貼り付け）」で一気に100問投入も可能
 *  ========================================================= */
let QUESTIONS = [
  {
    "id": "q001",
    "level": "Easy",
    "tags": ["Index"],
    "q": "meta robots noindex の主な目的は？",
    "choices": ["ランキングを上げる", "インデックスから除外させる意図を伝える", "クロール頻度を上げる", "必ず301を発生させる"],
    "answer": 1,
    "explain": "noindexは検索結果に出さない意図を伝える（命令ではなく解釈される）。"
  },
  {
    "id": "q002",
    "level": "Easy",
    "tags": ["Crawl", "Robots"],
    "q": "robots.txt でブロックすると起こりやすいことは？",
    "choices": ["ページ内容を解析できる", "ページを取得できないためnoindex等を読めない", "必ずインデックスが消える", "必ず404になる"],
    "answer": 1,
    "explain": "robotsブロックは取得自体を止めるため、メタ情報を読めないことがある。"
  },
  {
    "id": "q003",
    "level": "Easy",
    "tags": ["Index", "Canonical"],
    "q": "rel=canonical の位置づけとして最も正しいのは？",
    "choices": ["強制命令", "正規URLのシグナル（ヒント）", "必ずnoindexにする", "必ず301する"],
    "answer": 1,
    "explain": "canonicalはヒント。内部リンク/サイトマップ/リダイレクト等との整合が重要。"
  },
  {
    "id": "q004",
    "level": "Easy",
    "tags": ["Crawl", "Sitemap"],
    "q": "XMLサイトマップの役割として正しいのは？",
    "choices": ["掲載URLは必ずインデックス", "発見とクロールの手がかり", "ランキング要因そのもの", "重複URLを自動削除"],
    "answer": 1,
    "explain": "サイトマップは発見/優先度のヒント。インデックス保証ではない。"
  },
  {
    "id": "q005",
    "level": "Easy",
    "tags": ["Crawl", "Index"],
    "q": "HTTPステータス 404 が示すのは？",
    "choices": ["恒久移転", "一時移転", "見つからない", "サーバーエラー"],
    "answer": 2,
    "explain": "404はNot Found。削除/存在しないURLに返す。"
  },
  {
    "id": "q006",
    "level": "Easy",
    "tags": ["Index", "Redirect"],
    "q": "301 リダイレクトの意味は？",
    "choices": ["一時的な転送", "恒久的な転送", "クロール停止", "noindex命令"],
    "answer": 1,
    "explain": "301は恒久転送。正規化や移転時に使う。"
  },
  {
    "id": "q007",
    "level": "Easy",
    "tags": ["Index", "Redirect"],
    "q": "302 リダイレクトの意味は？",
    "choices": ["恒久転送", "一時転送", "404", "サーバーダウン"],
    "answer": 1,
    "explain": "302は基本的に一時転送。用途に応じて使い分ける。"
  },
  {
    "id": "q008",
    "level": "Easy",
    "tags": ["Index"],
    "q": "重複ページが大量にあると起きやすい問題は？",
    "choices": ["クロール効率低下や評価分散", "必ず順位が上がる", "必ずCWVが改善", "必ずサイトリンクが出る"],
    "answer": 0,
    "explain": "重複はクロール/評価の分散やインデックス品質低下につながる。"
  },
  {
    "id": "q009",
    "level": "Easy",
    "tags": ["Crawl"],
    "q": "内部リンクの主な価値は？",
    "choices": ["外部リンクを自動生成", "発見性と重要度シグナル", "広告収益を増やす", "画像を圧縮する"],
    "answer": 1,
    "explain": "内部リンクは発見性・巡回・重要度伝達に効く。"
  },
  {
    "id": "q010",
    "level": "Easy",
    "tags": ["Index"],
    "q": "URL正規化（canonical/redirect等）の目的は？",
    "choices": ["URLを増やす", "重複を統合し評価分散を防ぐ", "クローラをブロックする", "JSを減らす"],
    "answer": 1,
    "explain": "同一/類似コンテンツの評価分散を抑え、正規URLへ寄せる。"
  },

  {
    "id": "q011",
    "level": "Medium",
    "tags": ["Crawl"],
    "q": "クロールバジェットに影響しやすいのは？",
    "choices": ["サイトの色", "大量の重複URLや無駄URL", "h1の数", "OGPタグ"],
    "answer": 1,
    "explain": "無駄URL増加はクロールの浪費に直結する。"
  },
  {
    "id": "q012",
    "level": "Medium",
    "tags": ["Crawl", "Logs"],
    "q": "ログ分析で最も見たい指標の一つは？",
    "choices": ["フォントサイズ", "GooglebotのヒットURL/頻度/ステータス", "SNSいいね数", "画像の彩度"],
    "answer": 1,
    "explain": "どのURLにどれだけ来て何を返したかが分かる。"
  },
  {
    "id": "q013",
    "level": "Medium",
    "tags": ["Index"],
    "q": "Search Consoleの「クロール済み - インデックス未登録」で疑うべきは？",
    "choices": ["コンテンツ品質/重複/薄さ", "ドメイン期限切れ", "必ずrobotsブロック", "必ず手動ペナルティ"],
    "answer": 0,
    "explain": "品質や重複、価値不足でインデックスされないケースが多い。"
  },
  {
    "id": "q014",
    "level": "Medium",
    "tags": ["Index", "Robots"],
    "q": "X-Robots-Tag が使えるのは？",
    "choices": ["HTTPヘッダで制御できる", "HTML内だけ", "画像の色だけ", "CSSのみ"],
    "answer": 0,
    "explain": "HTTPヘッダでnoindex等を指定でき、PDFなどにも適用可能。"
  },
  {
    "id": "q015",
    "level": "Medium",
    "tags": ["Index", "Hreflang"],
    "q": "hreflangの目的は？",
    "choices": ["ページ速度改善", "言語/地域の適切なURLを提示", "必ず順位上昇", "クロール停止"],
    "answer": 1,
    "explain": "言語/地域ごとに適切なURLを検索エンジンに伝える。"
  },
  {
    "id": "q016",
    "level": "Medium",
    "tags": ["Index", "Hreflang"],
    "q": "hreflangで重要な実装要件は？",
    "choices": ["片方向でもOK", "相互参照（return tag）", "必ずJSで挿入", "必ず画像に埋め込む"],
    "answer": 1,
    "explain": "多くの場合、相互参照がないと不整合になりやすい。"
  },
  {
    "id": "q017",
    "level": "Medium",
    "tags": ["Index"],
    "q": "パラメータ付きURLが大量発生する典型例は？",
    "choices": ["ファセットナビ/並び替え/フィルタ", "OGP", "SVG", "favicon"],
    "answer": 0,
    "explain": "ECの絞り込み・並び替えは無限URLを生みやすい。"
  },
  {
    "id": "q018",
    "level": "Medium",
    "tags": ["Index", "Canonical"],
    "q": "canonical先が404のとき起きやすいのは？",
    "choices": ["必ず統合される", "シグナル無効化/無視されやすい", "必ず順位上がる", "必ずクロール停止"],
    "answer": 1,
    "explain": "正規先がエラーだと採用されにくい。ステータス整合が重要。"
  },
  {
    "id": "q019",
    "level": "Medium",
    "tags": ["Index", "Redirect"],
    "q": "リダイレクトチェーンが長いと何が起きやすい？",
    "choices": ["遅延・クロール効率悪化", "CLS改善", "画像最適化", "構造化データ増加"],
    "answer": 0,
    "explain": "チェーンは遅延とクロール浪費を招くので短縮が基本。"
  },
  {
    "id": "q020",
    "level": "Medium",
    "tags": ["Index"],
    "q": "HTTP→HTTPS移行で重要な対応は？",
    "choices": ["robotsを全部Disallow", "301/内部リンク/サイトマップ/正規化の統一", "タイトルを全部同じにする", "画像を全部PNG"],
    "answer": 1,
    "explain": "シグナルをHTTPSへ統一するのが基本。"
  },

  {
    "id": "q021",
    "level": "Medium",
    "tags": ["Rendering"],
    "q": "CSR（クライアントサイドレンダリング）だけに依存すると起きやすい課題は？",
    "choices": ["HTML初期表示が薄く発見/評価が遅れる", "必ず順位が上がる", "必ずLCP改善", "必ずクロール停止"],
    "answer": 0,
    "explain": "初期HTMLが薄いとレンダリング待ちで評価が遅れやすい。"
  },
  {
    "id": "q022",
    "level": "Medium",
    "tags": ["Rendering"],
    "q": "SSRの主なメリットは？",
    "choices": ["JSをゼロにできる", "初期HTMLに主要コンテンツを載せやすい", "必ず広告収益が上がる", "robotsが不要になる"],
    "answer": 1,
    "explain": "初期HTMLが充実し、発見/表示が安定しやすい。"
  },
  {
    "id": "q023",
    "level": "Medium",
    "tags": ["Rendering"],
    "q": "レンダリングブロックになりやすいのは？",
    "choices": ["同期読み込みのCSS/JS", "alt属性", "titleタグ", "canonicalタグ"],
    "answer": 0,
    "explain": "Critical CSSやdefer/asyncなどで影響を減らす。"
  },
  {
    "id": "q024",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "LCPは何を測る？",
    "choices": ["入力応答の速さ", "最大要素が表示されるまで", "レイアウトのズレ", "サーバーの稼働率"],
    "answer": 1,
    "explain": "Largest Contentful Paint＝主要（最大）要素の表示完了まで。"
  },
  {
    "id": "q025",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "CLSは何を測る？",
    "choices": ["ページの色", "レイアウトの視覚的なズレ", "JSの行数", "クロール頻度"],
    "answer": 1,
    "explain": "Cumulative Layout Shift＝視覚的なガタつき。"
  },
  {
    "id": "q026",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "INP（旧FIDより重視される指標）は何を測る？",
    "choices": ["画像サイズ", "操作に対する応答性", "robots設定", "サイトマップ数"],
    "answer": 1,
    "explain": "Interaction to Next Paint＝操作してから次の描画までの応答性。"
  },
  {
    "id": "q027",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "CLSを悪化させやすい要因は？",
    "choices": ["画像/広告枠のサイズ未指定", "gzip圧縮", "キャッシュ", "preconnect"],
    "answer": 0,
    "explain": "幅/高さ未指定で後から要素が押し下げるとズレが出る。"
  },
  {
    "id": "q028",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "LCP改善で効きやすいのは？",
    "choices": ["ヒーロー画像の最適化と優先読み込み", "h1を増やす", "OGタグ追加", "robotsをDisallow"],
    "answer": 0,
    "explain": "LCP要素（ヒーロー画像/大見出し）の最適化が効く。"
  },
  {
    "id": "q029",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "不要なJSが多いと悪化しやすい指標は？",
    "choices": ["INP/LCP", "hreflang", "canonical", "sitemap"],
    "answer": 0,
    "explain": "JS実行が重いと応答性や描画が遅れる。"
  },
  {
    "id": "q030",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "画像最適化で一般的に推奨されやすい形式は？",
    "choices": ["BMP", "WebP/AVIFなど", "TIFF", "PSD"],
    "answer": 1,
    "explain": "圧縮効率の高い次世代フォーマットが有利なことが多い。"
  },

  {
    "id": "q031",
    "level": "Medium",
    "tags": ["CWV", "Rendering"],
    "q": "フォント読み込みで表示遅延を減らす施策は？",
    "choices": ["font-display: swap", "h1を削除", "robotsブロック", "canonical削除"],
    "answer": 0,
    "explain": "swapでフォント待ちによる表示停止を減らす。"
  },
  {
    "id": "q032",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "CDNの主なメリットは？",
    "choices": ["データベースを消せる", "配信をユーザー近くにして遅延を減らす", "canonical不要", "必ず順位が上がる"],
    "answer": 1,
    "explain": "地理的に近いエッジから配信しTTFB等を改善しやすい。"
  },
  {
    "id": "q033",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "TTFBを改善しやすい要因は？",
    "choices": ["サーバー処理/キャッシュ/CDN", "alt属性", "h2の数", "OG画像"],
    "answer": 0,
    "explain": "初期応答はサーバー性能やキャッシュ戦略に依存しやすい。"
  },
  {
    "id": "q034",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "構造化データ（Schema）の主目的は？",
    "choices": ["検索エンジンへ意味を伝える", "必ず順位を上げる", "必ずクロール停止", "画像を圧縮する"],
    "answer": 0,
    "explain": "内容の意味付けを明確化し、リッチ結果等の理解を助ける。"
  },
  {
    "id": "q035",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "JSON-LDの特徴は？",
    "choices": ["HTMLと混ぜずに書けない", "scriptタグ内に書く形式", "robots.txtに書く", "CSSに書く"],
    "answer": 1,
    "explain": "JSON-LDはscript type=application/ld+json に記述する。"
  },
  {
    "id": "q036",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "構造化データのバリデーションに使う代表的なものは？",
    "choices": ["Rich Results Test", "PageSpeed Insights", "Ahrefs", "Photoshop"],
    "answer": 0,
    "explain": "Rich Results Test等でエラー/警告を確認できる。"
  },
  {
    "id": "q037",
    "level": "Medium",
    "tags": ["Logs"],
    "q": "5xxが多発していると起きやすいのは？",
    "choices": ["クロール低下/再試行増", "必ず順位上昇", "CLS改善", "構造化データ増"],
    "answer": 0,
    "explain": "サーバーエラーはクロール効率と評価に悪影響。"
  },
  {
    "id": "q038",
    "level": "Medium",
    "tags": ["Index"],
    "q": "soft 404（ソフト404）とは？",
    "choices": ["実際は200だが中身が無い/エラーに見える", "必ず301", "画像が無い", "JSが無い"],
    "answer": 0,
    "explain": "200返しても内容が無いとGoogleがsoft 404扱いすることがある。"
  },
  {
    "id": "q039",
    "level": "Medium",
    "tags": ["Index"],
    "q": "ページネーションでよくある課題は？",
    "choices": ["深いページが発見されにくい", "必ず順位上がる", "必ずnoindexになる", "必ずCLSが悪化"],
    "answer": 0,
    "explain": "深いページの発見性と内部リンク設計が重要。"
  },
  {
    "id": "q040",
    "level": "Medium",
    "tags": ["Index"],
    "q": "パラメータの正規化で一般的に使うのは？",
    "choices": ["canonical/内部リンク統一", "OGP", "favicon", "AMPだけ"],
    "answer": 0,
    "explain": "正規URLに寄せるシグナルを揃えるのが基本。"
  },

  {
    "id": "q041",
    "level": "Hard",
    "tags": ["Crawl", "Logs"],
    "q": "ログでGooglebotが特定ディレクトリばかりクロールする時に疑うべきは？",
    "choices": ["内部リンク偏り/無限URL/リダイレクト", "画像形式", "OGP設定", "タイトルの長さ"],
    "answer": 0,
    "explain": "巡回が偏る原因（無限URL/内部リンク/正規化）を疑う。"
  },
  {
    "id": "q042",
    "level": "Hard",
    "tags": ["Index", "Canonical"],
    "q": "canonicalが無視されやすいケースは？",
    "choices": ["正規先が別内容/エラー/シグナル不整合", "h1が1つ", "画像がWebP", "CSSが少ない"],
    "answer": 0,
    "explain": "内容一致とシグナル整合がないと採用されにくい。"
  },
  {
    "id": "q043",
    "level": "Hard",
    "tags": ["Index"],
    "q": "同一ページで canonical と noindex を同時に入れると？",
    "choices": ["意図が矛盾し評価が不安定になりうる", "必ず順位上昇", "必ずクロール停止", "必ず301になる"],
    "answer": 0,
    "explain": "canonicalは統合ヒント、noindexは除外意図で矛盾しやすい。"
  },
  {
    "id": "q044",
    "level": "Hard",
    "tags": ["Index", "Hreflang"],
    "q": "hreflang x-default の用途は？",
    "choices": ["デフォルトの言語/地域を示す", "速度改善", "クロール停止", "構造化データ"],
    "answer": 0,
    "explain": "どの言語にも合わない場合の既定URLを示す。"
  },
  {
    "id": "q045",
    "level": "Hard",
    "tags": ["Crawl"],
    "q": "巨大サイトでXMLサイトマップを分割する主な理由は？",
    "choices": ["管理・上限・更新単位を分けるため", "順位を上げるため", "robots不要になるため", "JSが減るため"],
    "answer": 0,
    "explain": "上限や運用面で分割し、更新管理をしやすくする。"
  },

  {
    "id": "q046",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "画像の遅延読み込み（lazy-load）で注意すべきは？",
    "choices": ["LCP要素を遅延させない", "必ずCLSが0になる", "robotsが不要", "canonicalが不要"],
    "answer": 0,
    "explain": "ヒーロー画像をlazyにするとLCPが悪化しやすい。"
  },
  {
    "id": "q047",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "preconnect の効果は？",
    "choices": ["外部接続の初期コストを先に払う", "画像を圧縮", "noindexを付与", "301を作る"],
    "answer": 0,
    "explain": "DNS/TLSなどの接続準備を前倒しできる。"
  },
  {
    "id": "q048",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "HTTPキャッシュが効くと改善しやすいのは？",
    "choices": ["再訪時の読み込み", "hreflang", "canonical採用", "robots解釈"],
    "answer": 0,
    "explain": "静的リソースの再取得を減らし表示が速くなる。"
  },
  {
    "id": "q049",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "FAQ構造化データで重要なのは？",
    "choices": ["ページ内に実際のQ&Aが存在する", "必ず順位が上がる", "JSだけで生成する", "robotsをDisallowする"],
    "answer": 0,
    "explain": "見えない/存在しない内容をマークアップするのはNG。"
  },
  {
    "id": "q050",
    "level": "Medium",
    "tags": ["Index"],
    "q": "rel='nofollow' の基本的な意味は？",
    "choices": ["リンクシグナルを渡さない意図", "必ずクロール停止", "必ずnoindex", "必ず順位上がる"],
    "answer": 0,
    "explain": "リンクの評価伝達を抑えるヒントとして扱われる。"
  },

  {
    "id": "q051",
    "level": "Medium",
    "tags": ["Index"],
    "q": "重複コンテンツ対策で最優先になりやすいのは？",
    "choices": ["正規URLへの統合（redirect/canonical）", "色を変える", "画像を増やす", "フォントを変える"],
    "answer": 0,
    "explain": "まず正規化の方針を決めてシグナルを統一する。"
  },
  {
    "id": "q052",
    "level": "Medium",
    "tags": ["Crawl"],
    "q": "サイト内検索結果ページを無制限にインデックスさせると？",
    "choices": ["薄いページが増えやすい", "必ず順位上昇", "必ずCWV改善", "必ず404になる"],
    "answer": 0,
    "explain": "内部検索は無限に近い薄いURLを生みやすい。"
  },
  {
    "id": "q053",
    "level": "Hard",
    "tags": ["Crawl", "Index"],
    "q": "URLパラメータで無限クロールが起きている時の優先対応は？",
    "choices": ["内部リンク/正規化/不要URLの生成抑制", "h1を増やす", "OGP追加", "画像形式変更のみ"],
    "answer": 0,
    "explain": "発生源を止め、正規化と内部リンクを整える。"
  },
  {
    "id": "q054",
    "level": "Medium",
    "tags": ["Index"],
    "q": "同一内容で / と /index.html が併存する時の基本は？",
    "choices": ["正規化（301/canonical/内部リンク統一）", "両方noindex", "robotsで両方ブロック", "何もしない"],
    "answer": 0,
    "explain": "正規URLを決めてシグナル統一が基本。"
  },
  {
    "id": "q055",
    "level": "Medium",
    "tags": ["Index"],
    "q": "wwwあり/なし、http/https が混在していると？",
    "choices": ["重複・評価分散・計測分断が起きやすい", "必ず順位上がる", "必ずCLS改善", "必ずnoindexになる"],
    "answer": 0,
    "explain": "1つに統一（リダイレクト＋内部リンク＋サイトマップ）。"
  },

  {
    "id": "q056",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "画像のサイズ指定（width/height）を入れる主な目的は？",
    "choices": ["CLSを抑える", "LCPを悪化させる", "robotsを簡略化", "canonicalを付与"],
    "answer": 0,
    "explain": "表示枠を確保してレイアウトズレを防ぐ。"
  },
  {
    "id": "q057",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "巨大なCSSが多いと起きやすいのは？",
    "choices": ["レンダリング遅延", "hreflang欠落", "サイトマップ消失", "404増加"],
    "answer": 0,
    "explain": "Critical CSSや分割で初期描画を速くする。"
  },
  {
    "id": "q058",
    "level": "Medium",
    "tags": ["Rendering"],
    "q": "defer 属性の効果は？",
    "choices": ["HTML解析をブロックしにくい順でJSを実行", "画像を圧縮", "noindex付与", "301作成"],
    "answer": 0,
    "explain": "パースを阻害しにくく、DOM構築後に実行される。"
  },
  {
    "id": "q059",
    "level": "Medium",
    "tags": ["Rendering"],
    "q": "async 属性の特徴は？",
    "choices": ["読み込み完了次第すぐ実行され順序は保証されない", "必ず順番通り実行", "CSS専用", "robots専用"],
    "answer": 0,
    "explain": "依存関係があるスクリプトには注意。"
  },
  {
    "id": "q060",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "Organization構造化データでよく使うのは？",
    "choices": ["name/logo/sameAs など", "LCP/CLS", "canonicalのみ", "robotsのみ"],
    "answer": 0,
    "explain": "ブランドの同一性（ロゴ・公式SNS等）を補助できる。"
  },

  {
    "id": "q061",
    "level": "Medium",
    "tags": ["Index"],
    "q": "rel='prev/next' は現在どう扱われることが多い？",
    "choices": ["Googleではランキング/統合の強いシグナルではない", "必ず統合される", "必ずnoindex", "必ず301"],
    "answer": 0,
    "explain": "現在は強いインデックス統合の仕組みとしては期待しすぎない。"
  },
  {
    "id": "q062",
    "level": "Medium",
    "tags": ["Index"],
    "q": "パンくずリストがSEOに役立つ理由は？",
    "choices": ["階層構造を明確にし内部リンクを補強", "画像圧縮になる", "robots不要になる", "必ず順位上がる"],
    "answer": 0,
    "explain": "情報設計と内部リンクの強化につながる。"
  },
  {
    "id": "q063",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "BreadcrumbList構造化データの効果として適切なのは？",
    "choices": ["検索結果でパンくず表示の理解を助ける", "必ず順位上昇", "必ずインデックス削除", "CLS改善"],
    "answer": 0,
    "explain": "パンくずの意味付けを検索エンジンに伝える。"
  },
  {
    "id": "q064",
    "level": "Medium",
    "tags": ["Logs"],
    "q": "「クロールは来ているが重要ページに少ない」時の打ち手は？",
    "choices": ["内部リンク強化/サイトマップ整備/無駄URL削減", "色変更", "OGP", "画像をBMP化"],
    "answer": 0,
    "explain": "重要ページに巡回を寄せる設計が必要。"
  },
  {
    "id": "q065",
    "level": "Medium",
    "tags": ["Crawl"],
    "q": "HTTP 429 が増えている時に疑うのは？",
    "choices": ["レート制限/ボット制御/サーバー設定", "canonical", "hreflang", "タイトル"],
    "answer": 0,
    "explain": "Too Many Requests。アクセス制限の調整が必要な場合がある。"
  },

  {
    "id": "q066",
    "level": "Medium",
    "tags": ["Index"],
    "q": "PDFを検索結果に出したくない時に使えるのは？",
    "choices": ["X-Robots-Tag: noindex", "titleタグ短縮", "h1を増やす", "OGP追加"],
    "answer": 0,
    "explain": "HTML以外はHTTPヘッダnoindexが便利。"
  },
  {
    "id": "q067",
    "level": "Hard",
    "tags": ["Index"],
    "q": "「インデックス登録をリクエスト」しても反映されない典型理由は？",
    "choices": ["品質/重複/価値不足", "favicon未設定", "OGP未設定", "色が暗い"],
    "answer": 0,
    "explain": "リクエストは優先度を上げるだけで、品質問題は解決しない。"
  },
  {
    "id": "q068",
    "level": "Hard",
    "tags": ["Index"],
    "q": "パラメータURLを大量にnoindexする時の注意点は？",
    "choices": ["クロール負荷は残りうる（発生源対策も必要）", "必ずクロールが止まる", "必ず順位が上がる", "必ずJSが減る"],
    "answer": 0,
    "explain": "noindexはインデックス除外意図。発生抑制・正規化も重要。"
  },
  {
    "id": "q069",
    "level": "Hard",
    "tags": ["Crawl"],
    "q": "クロールを“止めたい”のか“インデックスさせたくない”のかで最も違うのは？",
    "choices": ["robotsとnoindexの使い分け", "画像形式", "タイトル長", "OGP"],
    "answer": 0,
    "explain": "noindexはクロール必要な場合が多い。目的を分ける。"
  },
  {
    "id": "q070",
    "level": "Medium",
    "tags": ["Crawl"],
    "q": "サイトマップに載せるべきURLは基本的に？",
    "choices": ["インデックスさせたい正規URL", "全URL（パラメータ含む）", "404 URL", "robotsブロックURLだけ"],
    "answer": 0,
    "explain": "正規URLを載せ、余計なURLは入れないのが基本。"
  },

  {
    "id": "q071",
    "level": "Medium",
    "tags": ["Index"],
    "q": "同一内容で言語だけ違うページを統合（canonical）してよい？",
    "choices": ["基本は統合しない（hreflang等で出し分け）", "常に統合すべき", "常にnoindex", "常にrobotsブロック"],
    "answer": 0,
    "explain": "言語別は統合より出し分けが一般的。"
  },
  {
    "id": "q072",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "Article構造化データで重要なプロパティ例は？",
    "choices": ["headline/datePublished/author", "LCP/CLS", "canonicalのみ", "robotsのみ"],
    "answer": 0,
    "explain": "記事の属性（見出し/著者/公開日）を明確にする。"
  },
  {
    "id": "q073",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "Product構造化データでよく使うのは？",
    "choices": ["name/offers/price/availability", "h1/h2", "robots", "HTTP 500"],
    "answer": 0,
    "explain": "価格/在庫/商品属性が中心。"
  },
  {
    "id": "q074",
    "level": "Hard",
    "tags": ["Schema"],
    "q": "構造化データでやってはいけないのは？",
    "choices": ["ページに存在しない内容をマークアップ", "実データをマークアップ", "テストで検証", "エラーを修正"],
    "answer": 0,
    "explain": "ユーザーに見えない虚偽情報のマークアップはNG。"
  },
  {
    "id": "q075",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "画像をレスポンシブで出し分ける代表的手法は？",
    "choices": ["srcset/sizes", "noindex", "robots", "hreflang"],
    "answer": 0,
    "explain": "端末に応じた画像を配信しやすい。"
  },

  {
    "id": "q076",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "圧縮（gzip/br）で主に軽くなるのは？",
    "choices": ["HTML/CSS/JSなどのテキスト資産", "PNGだけ", "動画だけ", "PDFだけ"],
    "answer": 0,
    "explain": "テキスト系リソースに効きやすい。"
  },
  {
    "id": "q077",
    "level": "Medium",
    "tags": ["CWV"],
    "q": "HTTP/2 のメリットとして適切なのは？",
    "choices": ["多重化などで効率的に転送できる", "必ず画像がWebPになる", "robotsが不要", "必ず順位上がる"],
    "answer": 0,
    "explain": "多重化により並列転送が効率化されやすい。"
  },
  {
    "id": "q078",
    "level": "Hard",
    "tags": ["CWV"],
    "q": "サードパーティタグが多いと悪化しやすいのは？",
    "choices": ["INP/LCP/総合パフォーマンス", "hreflang精度", "canonical採用", "robots解釈"],
    "answer": 0,
    "explain": "外部JSが増えると描画と応答性が落ちやすい。"
  },
  {
    "id": "q079",
    "level": "Hard",
    "tags": ["Logs"],
    "q": "ログで 301→200 の成功でも課題になりうるのは？",
    "choices": ["チェーンが長い/大量に発生している", "必ず順位上昇", "CLSが0になる", "構造化データ増"],
    "answer": 0,
    "explain": "大量チェーンはクロール浪費。直接200へ寄せる。"
  },
  {
    "id": "q080",
    "level": "Hard",
    "tags": ["Crawl"],
    "q": "カテゴリページが薄い場合の典型改善は？",
    "choices": ["意図に合う説明/内部リンク/ファセット整理", "robotsでブロック", "全てnoindex", "画像をBMPに"],
    "answer": 0,
    "explain": "薄い一覧は補足情報と設計で価値を上げる。"
  },

  {
    "id": "q081",
    "level": "Medium",
    "tags": ["Index"],
    "q": "同じコンテンツが複数URLで出る原因になりやすいのは？",
    "choices": ["末尾スラッシュ/大文字小文字/UTM/パラメータ", "CSS", "OGP", "favicon"],
    "answer": 0,
    "explain": "URL揺れの統一が重要。"
  },
  {
    "id": "q082",
    "level": "Medium",
    "tags": ["Index"],
    "q": "大文字URLと小文字URLが別扱いになる可能性があるのは？",
    "choices": ["サーバー設定次第で区別される", "必ず同一扱い", "必ず404", "必ず301"],
    "answer": 0,
    "explain": "ケースにより別URL。統一方針が必要。"
  },
  {
    "id": "q083",
    "level": "Medium",
    "tags": ["Index"],
    "q": "正規URLを内部リンクで一貫させることの目的は？",
    "choices": ["canonical採用を助ける", "CLS改善", "画像圧縮", "robots簡略化"],
    "answer": 0,
    "explain": "シグナル一貫性を高めて正規化の精度を上げる。"
  },
  {
    "id": "q084",
    "level": "Hard",
    "tags": ["Index"],
    "q": "「重複、Googleにより正規URLが選択されました」で重要なのは？",
    "choices": ["Googleの選択理由（内部リンク/サイトマップ/内容一致）を改善", "色を変える", "OGP", "画像形式だけ変更"],
    "answer": 0,
    "explain": "Googleの正規選択を理解し、シグナルを揃える。"
  },
  {
    "id": "q085",
    "level": "Medium",
    "tags": ["Index"],
    "q": "URL検査で「検出 - インデックス未登録」が多い時は？",
    "choices": ["内部リンク/サイトマップ/発見経路を改善", "h1を増やす", "OGP追加", "画像をBMP"],
    "answer": 0,
    "explain": "発見経路（内部リンク/サイトマップ）を強くする。"
  },

  {
    "id": "q086",
    "level": "Medium",
    "tags": ["Crawl"],
    "q": "孤立ページ（Orphan page）の課題は？",
    "choices": ["発見されにくい", "必ず順位上がる", "必ずCWV改善", "必ずnoindex"],
    "answer": 0,
    "explain": "内部リンクがないと発見性が低い。"
  },
  {
    "id": "q087",
    "level": "Hard",
    "tags": ["Crawl"],
    "q": "孤立ページを減らす最も直接的な施策は？",
    "choices": ["内部リンクを張る/サイト構造を見直す", "OGP", "画像圧縮だけ", "robotsブロック"],
    "answer": 0,
    "explain": "発見性の設計問題なので内部リンクが本筋。"
  },
  {
    "id": "q088",
    "level": "Medium",
    "tags": ["Index"],
    "q": "カテゴリ一覧に同一商品が大量に重複表示されると？",
    "choices": ["薄い重複ページが増えやすい", "必ず順位上がる", "必ずLCP改善", "必ずnoindex"],
    "answer": 0,
    "explain": "重複や薄さが増えると評価が落ちやすい。"
  },
  {
    "id": "q089",
    "level": "Hard",
    "tags": ["CWV"],
    "q": "動画・巨大画像がファーストビューにあると最優先で見る指標は？",
    "choices": ["LCP", "hreflang", "canonical", "robots"],
    "answer": 0,
    "explain": "ファーストビューの最大要素がLCPになりやすい。"
  },
  {
    "id": "q090",
    "level": "Hard",
    "tags": ["CWV"],
    "q": "モバイルでタップ遅延が体感される時に疑うのは？",
    "choices": ["メインスレッド占有（JS重い）→INP悪化", "robots", "hreflang", "サイトマップ"],
    "answer": 0,
    "explain": "応答性はINP。JSの削減や分割が効く。"
  },

  {
    "id": "q091",
    "level": "Medium",
    "tags": ["Schema"],
    "q": "レビューの構造化データで注意すべきは？",
    "choices": ["自己サイトの実体験に基づく/ガイドライン遵守", "適当に星5を書く", "ページに表示しない", "robotsで隠す"],
    "answer": 0,
    "explain": "ガイドライン違反や虚偽レビューはリスク。"
  },
  {
    "id": "q092",
    "level": "Hard",
    "tags": ["Schema"],
    "q": "構造化データのエラーと警告の違いは？",
    "choices": ["エラーは機能しない可能性が高い／警告は一部不足", "両方同じ", "警告の方が致命的", "エラーは無視でOK"],
    "answer": 0,
    "explain": "エラーは必ず修正優先。警告は影響範囲を見て対応。"
  },
  {
    "id": "q093",
    "level": "Hard",
    "tags": ["Logs"],
    "q": "Googlebotが大量に 404 を踏んでいる時の基本対応は？",
    "choices": ["内部リンク/サイトマップ/リダイレクトの整理", "OGP追加", "画像をWebP", "色を変える"],
    "answer": 0,
    "explain": "発生源（リンク/旧URL）を潰す。必要なら適切に301。"
  },
  {
    "id": "q094",
    "level": "Hard",
    "tags": ["Logs"],
    "q": "Googlebotが特定パラメータを延々クロールする時の本質対策は？",
    "choices": ["URL生成ロジック/内部リンク/正規化で止血", "OGP", "画像圧縮だけ", "タイトル変更"],
    "answer": 0,
    "explain": "無限URLの発生源を止めるのが最優先。"
  },
  {
    "id": "q095",
    "level": "Hard",
    "tags": ["Index"],
    "q": "一括でURLを“消したい”時、noindexだけで十分？",
    "choices": ["用途次第。削除/410/404や内部リンク整理も必要", "常に十分", "常に無意味", "常に301だけでOK"],
    "answer": 0,
    "explain": "目的（削除/統合/非表示）により最適手段が変わる。"
  },

  {
    "id": "q096",
    "level": "Medium",
    "tags": ["Index"],
    "q": "410 Gone の意味は？",
    "choices": ["恒久的に削除された", "一時的に移転", "サーバーエラー", "アクセス制限"],
    "answer": 0,
    "explain": "410は削除を明確に伝えるステータス。"
  },
  {
    "id": "q097",
    "level": "Hard",
    "tags": ["Index", "Redirect"],
    "q": "移転後、旧URLが検索結果に残り続ける時に見直すのは？",
    "choices": ["301の有無/内部リンク/サイトマップ/キャッシュ/正規化", "OGP", "色", "画像形式のみ"],
    "answer": 0,
    "explain": "シグナル統一とリダイレクトの整合が基本。"
  },
  {
    "id": "q098",
    "level": "Hard",
    "tags": ["Crawl", "Index"],
    "q": "クロールは増えたのにインデックスが増えない時の典型原因は？",
    "choices": ["品質・重複・価値不足", "フォント変更", "OGP", "favicon"],
    "answer": 0,
    "explain": "クロール＝インデックスではない。品質と重複が重要。"
  },
  {
    "id": "q099",
    "level": "Hard",
    "tags": ["CWV"],
    "q": "PageSpeedの“ラボデータ”と“フィールドデータ”の違いは？",
    "choices": ["ラボは環境固定/推定、フィールドは実ユーザー計測", "両方同じ", "フィールドは推定", "ラボは実ユーザー"],
    "answer": 0,
    "explain": "改善判断はフィールド（CrUX）も合わせて見る。"
  },
  {
    "id": "q100",
    "level": "Hard",
    "tags": ["Index", "Crawl"],
    "q": "100問完走で得たいスキルは？（このクイズの狙いに近いのは）",
    "choices": ["暗記だけ", "原理→現象→打ち手の因果で説明できる力", "デザイン力", "動画編集力"],
    "answer": 1,
    "explain": "テクニカルSEOは“現象の原因→最短の打ち手”を説明できると強い。"
  }
];

/** =========================================================
 *  2) ランク設計（“正解数”でランク付与）
 *     100問にした時に映えるように設計
 *  ========================================================= */
const RANKS = [
  { name: "Novice",        minCorrect: 0,   msg: "まずはウォームアップ。基礎から積み上げよう。" },
  { name: "Apprentice",    minCorrect: 10,  msg: "いい感じ。クローラビリティ/インデックスの基本が見えてきた。" },
  { name: "Specialist",    minCorrect: 25,  msg: "実務レベル。技術SEOの全体像が整理できている。" },
  { name: "Senior",        minCorrect: 50,  msg: "強い。設計と改善の打ち手が安定している。" },
  { name: "Architect",     minCorrect: 75,  msg: "設計者。大規模サイトでも戦える。" },
  { name: "Legend",        minCorrect: 100, msg: "到達点。テクニカルSEOの総合力が高い。" }
];

const STORAGE_KEY = "techseo_state_v2";

/** =========================================================
 *  3) 状態
 *  ========================================================= */
const $ = (id)=>document.getElementById(id);

const scoreEl = $("score");
const correctEl = $("correct");
const streakEl = $("streak");
const remainingEl = $("remaining");
const timeEl = $("time");
const bestEl = $("best");
const bestRankEl = $("bestRank");
const rankEl = $("rank");
const qMetaEl = $("qMeta");
const qEl = $("question");
const choicesEl = $("choices");
const feedbackEl = $("feedback");
const barEl = $("bar");
const progressLabelEl = $("progressLabel");
const bestBoxEl = $("bestBox");

const modeEl = $("mode");
const orderEl = $("order");
const limitEl = $("limit");

const startBtn = $("startBtn");
const nextBtn = $("nextBtn");
const skipBtn = $("skipBtn");
const resetBestBtn = $("resetBestBtn");
const shareBtn = $("shareBtn");

const overlay = $("overlay");
const rankTitle = $("rankTitle");
const rankSub = $("rankSub");
const closeModalBtn = $("closeModalBtn");

const confetti = $("confetti");

const importBtn = $("importBtn");
const importOverlay = $("importOverlay");
const importArea = $("importArea");
const cancelImportBtn = $("cancelImportBtn");
const applyImportBtn = $("applyImportBtn");

let deck = [];
let idx = 0;
let current = null;
let locked = false;

let timer = null;
let remaining = 0;

let score = 0;
let correct = 0;
let streak = 0;

let best = 0;
let bestRank = "—";
let lastRankShown = "Novice";

/** =========================================================
 *  4) ユーティリティ
 *  ========================================================= */
function shuffle(arr){
  const a = [...arr];
  for (let i=a.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function getRankNameByCorrect(c){
  let r = RANKS[0];
  for (const item of RANKS){
    if (c >= item.minCorrect) r = item;
  }
  return r.name;
}
function getRankByName(name){
  return RANKS.find(r=>r.name===name) || RANKS[0];
}

function updateRankUI(){
  const rn = getRankNameByCorrect(correct);
  rankEl.textContent = rn;
  return rn;
}

function saveState(){
  const state = {
    best,
    bestRank,
    lastRankShown,
    importedQuestions: QUESTIONS
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    if(typeof s.best === "number") best = s.best;
    if(typeof s.bestRank === "string") bestRank = s.bestRank;
    if(typeof s.lastRankShown === "string") lastRankShown = s.lastRankShown;
    if(Array.isArray(s.importedQuestions) && s.importedQuestions.length){
      // 以前インポートした問題があれば復元
      QUESTIONS = s.importedQuestions;
    }
  }catch(e){}
}

function setProgress(){
  const total = deck.length || 0;
  const done = Math.min(idx, total);
  progressLabelEl.textContent = `進捗 ${done} / ${total}`;
  const pct = total ? (done/total)*100 : 0;
  barEl.style.width = `${pct}%`;
}

function setTimer(){
  clearInterval(timer);
  const limit = Math.max(0, Number(limitEl.value || 0));
  if(limit === 0){
    timeEl.textContent = "∞";
    return;
  }
  remaining = limit;
  timeEl.textContent = String(remaining);
  timer = setInterval(()=>{
    remaining--;
    timeEl.textContent = String(remaining);
    if(remaining <= 0){
      clearInterval(timer);
      timeEl.textContent = "0";
      if(!locked) judge(-1);
    }
  },1000);
}

function buildDeck(){
  const tag = modeEl.value;
  const filtered = QUESTIONS.filter(q=>{
    if(tag === "all") return true;
    return (q.tags || []).includes(tag);
  });

  // 0件対策
  const use = filtered.length ? filtered : QUESTIONS;

  deck = use.map(q=>q.id);
  if(orderEl.value === "random") deck = shuffle(deck);
  idx = 0;

  remainingEl.textContent = String(deck.length);
  setProgress();
}

function getById(id){
  return QUESTIONS.find(q=>q.id===id);
}

function renderMeta(q){
  const chips = [];
  chips.push(`<span class="chip">Lv: ${q.level || "—"}</span>`);
  (q.tags||[]).forEach(t=>chips.push(`<span class="chip">${t}</span>`));
  qMetaEl.innerHTML = chips.join("");
}

/** =========================================================
 *  5) Confetti / Rank Modal
 *  ========================================================= */
function popConfetti(){
  confetti.innerHTML = "";
  confetti.classList.add("show");
  const colors = [
    "rgba(124,92,255,.95)",
    "rgba(34,193,195,.95)",
    "rgba(255,255,255,.9)",
    "rgba(45,212,191,.95)",
    "rgba(251,113,133,.95)"
  ];
  const count = 70;
  for(let i=0;i<count;i++){
    const d = document.createElement("div");
    d.className = "piece";
    d.style.left = Math.random()*100 + "vw";
    d.style.background = colors[Math.floor(Math.random()*colors.length)];
    d.style.animationDuration = (1.8 + Math.random()*1.6) + "s";
    d.style.animationDelay = (Math.random()*0.15) + "s";
    d.style.transform = `rotate(${Math.random()*180}deg)`;
    d.style.width = (8 + Math.random()*10) + "px";
    d.style.height = (10 + Math.random()*16) + "px";
    confetti.appendChild(d);
  }
  setTimeout(()=>confetti.classList.remove("show"), 2400);
}

function showRankModal(rankName){
  const r = getRankByName(rankName);
  rankTitle.textContent = rankName;
  rankSub.textContent = `正解数 ${correct} 達成！ ${r.msg}`;
  overlay.classList.add("show");
  popConfetti();
}

function closeModal(){
  overlay.classList.remove("show");
}

/** =========================================================
 *  6) ゲーム
 *  ========================================================= */
function renderQuestion(){
  locked = false;
  feedbackEl.classList.remove("show");
  feedbackEl.innerHTML = "";

  const id = deck[idx];
  current = getById(id);

  remainingEl.textContent = String(deck.length - idx);
  setProgress();

  renderMeta(current);
  qEl.textContent = current.q;

  choicesEl.innerHTML = "";
  (current.choices || []).forEach((text,i)=>{
    const b = document.createElement("button");
    b.className = "btn choice";
    b.innerHTML = `<b style="opacity:.9">${i+1}.</b> ${text}`;
    b.onclick = ()=>judge(i);
    choicesEl.appendChild(b);
  });

  setTimer();
}

function endScreen(){
  clearInterval(timer);
  qMetaEl.innerHTML = "";
  const total = deck.length || 0;
  const acc = total ? Math.round((correct/total)*100) : 0;

  qEl.textContent = `終了！ スコア ${score} / 正解 ${correct}/${total}（正答率 ${acc}%）`;
  choicesEl.innerHTML = "";

  feedbackEl.classList.add("show");
  feedbackEl.innerHTML = `
    <div class="row" style="justify-content:space-between">
      <div><b>最終ランク:</b> <span class="ok">${getRankNameByCorrect(correct)}</span></div>
      <div class="muted">自己ベスト: <b>${best}</b> / 最高ランク: <b>${bestRank}</b></div>
    </div>
    <div class="hr"></div>
    <div class="muted">次の目標: 正解数を増やしてランクアップを狙おう（100問版だと「Legend」到達が熱い）。</div>
  `;
  timeEl.textContent = "—";
  remainingEl.textContent = "0";
  setProgress();
}

function updateHUD(){
  scoreEl.textContent = String(score);
  correctEl.textContent = String(correct);
  streakEl.textContent = String(streak);

  const rn = updateRankUI();

  // 最高記録更新
  if(score > best){
    best = score;
    bestEl.textContent = String(best);
  }
  // 最高ランク更新
  const currentRankIndex = RANKS.findIndex(r=>r.name===rn);
  const bestRankIndex = RANKS.findIndex(r=>r.name===bestRank);
  if(currentRankIndex > bestRankIndex){
    bestRank = rn;
    bestRankEl.textContent = bestRank;
  }
  saveState();
}

function judge(choiceIndex){
  if(!current || locked) return;
  locked = true;
  clearInterval(timer);

  const correctIndex = current.answer;
  const buttons = [...choicesEl.querySelectorAll("button.choice")];

  // time out or reveal
  const isTimeout = (choiceIndex === -1);
  const isReveal = (choiceIndex === -2);

  let ok = false;
  if(!isTimeout && !isReveal){
    ok = (choiceIndex === correctIndex);
  }

  // mark
  buttons.forEach((b,i)=>{
    if(i === correctIndex) b.classList.add("correct");
    if(!ok && i === choiceIndex) b.classList.add("wrong");
  });

  if(ok){
    correct += 1;
    score += 10 + Math.min(10, streak);
    streak += 1;
  }else{
    streak = 0;
  }

  // rank up check
  const before = getRankNameByCorrect(correct - (ok ? 1 : 0));
  const after  = getRankNameByCorrect(correct);
  if(after !== before && after !== lastRankShown){
    lastRankShown = after;
    showRankModal(after);
  }

  updateHUD();

  const status = ok ? `<b class="ok">正解</b>` : `<b class="ng">${isTimeout ? "時間切れ" : (isReveal ? "解説表示" : "不正解")}</b>`;
  feedbackEl.classList.add("show");
  feedbackEl.innerHTML = `
    <div class="row" style="justify-content:space-between;align-items:flex-start">
      <div>${status} <span class="muted">（正解: ${correctIndex+1}）</span></div>
      <div class="muted">タグ: ${(current.tags||[]).join(", ")}</div>
    </div>
    <div class="hr"></div>
    <div>${current.explain || ""}</div>
  `;
}

function next(){
  clearInterval(timer);
  if(!deck.length) return;
  idx++;
  if(idx >= deck.length){
    endScreen();
    return;
  }
  renderQuestion();
}

function start(){
  // reset run stats
  score = 0;
  correct = 0;
  streak = 0;
  idx = 0;
  locked = false;
  lastRankShown = "Novice";

  scoreEl.textContent = "0";
  correctEl.textContent = "0";
  streakEl.textContent = "0";
  timeEl.textContent = "—";

  buildDeck();
  updateRankUI();
  updateHUD();

  renderQuestion();
}

/** =========================================================
 *  7) Import JSON（100問を一気に投入できる）
 *  ========================================================= */
function openImport(){
  importArea.value = JSON.stringify(QUESTIONS, null, 2);
  importOverlay.classList.add("show");
}
function closeImport(){
  importOverlay.classList.remove("show");
}
function applyImport(){
  try{
    const parsed = JSON.parse(importArea.value);
    if(!Array.isArray(parsed)) throw new Error("配列ではありません");

    // ざっくり検証
    for(const q of parsed){
      if(!q.id || !q.q || !Array.isArray(q.choices) || typeof q.answer !== "number"){
        throw new Error("形式が不正な問題が含まれています");
      }
      if(q.choices.length < 2) throw new Error("choicesが少なすぎます");
    }

    QUESTIONS = parsed;
    saveState();
    closeImport();
    alert(`適用しました：${QUESTIONS.length}問`);
  }catch(e){
    alert("JSONの形式エラー: " + e.message);
  }
}

/** =========================================================
 *  8) イベント
 *  ========================================================= */
startBtn.onclick = start;
nextBtn.onclick = next;

skipBtn.onclick = ()=>{
  if(!current) return;
  streak = 0;
  updateHUD();
  next();
};

resetBestBtn.onclick = ()=>{
  localStorage.removeItem(STORAGE_KEY);
  best = 0;
  bestRank = "—";
  bestEl.textContent = "0";
  bestRankEl.textContent = "—";
  alert("記録をリセットしました");
};

shareBtn.onclick = async ()=>{
  try{
    await navigator.clipboard.writeText(location.href);
    shareBtn.textContent = "✅ コピーしました";
    setTimeout(()=>shareBtn.textContent="🔗 URLをコピー", 1200);
  }catch(e){
    prompt("このURLをコピーして共有:", location.href);
  }
};

closeModalBtn.onclick = closeModal;
overlay.addEventListener("click", (e)=>{ if(e.target===overlay) closeModal(); });

importBtn.onclick = openImport;
cancelImportBtn.onclick = closeImport;
applyImportBtn.onclick = applyImport;
importOverlay.addEventListener("click", (e)=>{ if(e.target===importOverlay) closeImport(); });

document.addEventListener("keydown",(e)=>{
  if(overlay.classList.contains("show")){
    if(e.key==="Escape" || e.key==="Enter") closeModal();
    return;
  }
  if(importOverlay.classList.contains("show")){
    if(e.key==="Escape") closeImport();
    return;
  }
  if(!current) return;
  if(e.key >= "1" && e.key <= "4" && !locked){
    judge(Number(e.key)-1);
  }
  if(e.key === "Enter") next();
});

/** =========================================================
 *  9) 初期化（保存済みがあれば復元）
 *  ========================================================= */
loadState();
bestEl.textContent = String(best);
bestRankEl.textContent = bestRank;

</script>
</body>
</html>
